<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastery Pr√ºfung - 5. Klasse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* Sicherstellung der Klick-Fl√§chen */
        .keypad-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen">
    <div id="app" class="max-w-md mx-auto flex flex-col min-h-screen p-4">
        <!-- Header -->
        <header class="flex justify-between items-center py-4 mb-6">
            <div class="flex items-center gap-4">
                <a href="index.html" class="p-2 bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </a>
                <h1 class="text-xl font-black tracking-tighter text-red-500 uppercase">Abschlusspr√ºfung</h1>
            </div>
            <div class="text-right">
                <div class="text-[10px] font-bold text-slate-500 uppercase">Fortschritt</div>
                <div class="flex gap-1 mt-1" id="dots"></div>
            </div>
        </header>

        <main id="main-content" class="flex-1 flex flex-col justify-center">
            <!-- Dynamischer Content wird hier injiziert -->
        </main>

        <!-- Footer Info -->
        <footer class="py-4 text-center text-slate-600 text-[10px]">
            Mastery Mode: Ein Fehler setzt dich auf Aufgabe 1 zur√ºck.
        </footer>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 20;
        let seed = Date.now();
        let currentAnswer = "";
        
        function getSeededRandom(min, max, offset = 0) {
            const x = Math.sin(seed + currentStep + offset) * 10000;
            return Math.floor((x - Math.floor(x)) * (max - min + 1)) + min;
        }

        function generateTask() {
            const type = getSeededRandom(1, 5);
            
            if (type === 1) { // Durchschnitt
                const a = getSeededRandom(5, 15);
                const b = getSeededRandom(5, 15);
                const c = 30 - a - b;
                return { q: `Berechne den Durchschnitt von: ${a}, ${b} und ${c}`, a: "10" };
            }
            if (type === 2) { // Variable
                const x = getSeededRandom(11, 40);
                const base = getSeededRandom(10, 50);
                return { q: `Finde x: ${base} + x = ${base + x}`, a: x.toString() };
            }
            if (type === 3) { // Gr√∂ssen
                const km = getSeededRandom(2, 8);
                return { q: `Wie viele Meter sind ${km} km?`, a: (km * 1000).toString() };
            }
            if (type === 4) { // Grosse Zahlen
                const start = getSeededRandom(990, 998) * 1000 + 999;
                return { q: `Was ist der Nachfolger von ${start.toLocaleString('de-CH')}?`, a: (start + 1).toString() };
            }
            if (type === 5) { // Geometrie
                const s = getSeededRandom(4, 9);
                return { q: `Fl√§che eines Quadrats mit Seite ${s} cm?`, a: (s * s).toString() };
            }
        }

        let task = generateTask();

        function render() {
            const main = document.getElementById('main-content');
            const dots = document.getElementById('dots');
            
            // Progress Dots
            dots.innerHTML = Array.from({length: totalSteps}).map((_, i) => 
                `<div class="w-1.5 h-1.5 rounded-full ${i < currentStep ? 'bg-green-500' : (i === currentStep ? 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)]' : 'bg-slate-700')}"></div>`
            ).join('');

            if (currentStep >= totalSteps) {
                main.innerHTML = `
                    <div class="bg-white text-slate-900 p-8 rounded-3xl shadow-2xl text-center animate-in zoom-in duration-500">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-black mb-2 text-red-600">BESTANDEN!</h2>
                        <p class="mb-8 text-slate-600">Du hast 20 Aufgaben ohne Fehler gel√∂st. Du bist ein Mathe-Meister.</p>
                        <div class="p-4 bg-green-100 text-green-700 font-bold rounded-xl mb-6 flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
                            GAMING-FREIGABE AKTIVIERT
                        </div>
                        <a href="index.html" class="block w-full bg-slate-900 text-white p-4 rounded-xl font-bold hover:bg-black transition-colors">Zur√ºck zum Start</a>
                    </div>`;
                return;
            }

            main.innerHTML = `
                <div class="bg-slate-800 p-8 rounded-3xl border border-slate-700 mb-8 min-h-[160px] flex flex-col justify-center shadow-lg relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-red-600"></div>
                    <div class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-2">Aufgabe ${currentStep + 1} von ${totalSteps}</div>
                    <div class="text-2xl font-bold leading-tight mb-4">${task.q}</div>
                    <div class="flex items-end gap-3 h-12">
                        <div class="text-slate-400 text-sm font-semibold pb-1">Ergebnis:</div>
                        <div class="flex-1 text-4xl font-black text-red-500 border-b-4 border-red-500 pb-1 min-h-[48px] flex justify-center items-center">
                            ${currentAnswer || '<span class="text-slate-700">?</span>'}
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-3">
                    ${[1,2,3,4,5,6,7,8,9].map(n => `
                        <button onclick="add('${n}')" class="keypad-btn h-16 bg-slate-100 hover:bg-white text-slate-900 rounded-2xl text-2xl font-black shadow-[0_4px_0_#cbd5e1] active:shadow-none active:translate-y-1 transition-all">
                            ${n}
                        </button>`).join('')}
                    <button onclick="clearAll()" class="keypad-btn h-16 bg-red-100 hover:bg-red-50 text-red-600 rounded-2xl text-2xl font-black shadow-[0_4px_0_#fecaca] active:shadow-none active:translate-y-1 transition-all">C</button>
                    <button onclick="add('0')" class="keypad-btn h-16 bg-slate-100 hover:bg-white text-slate-900 rounded-2xl text-2xl font-black shadow-[0_4px_0_#cbd5e1] active:shadow-none active:translate-y-1 transition-all">0</button>
                    <button onclick="submit()" class="keypad-btn h-16 bg-red-600 hover:bg-red-500 text-white rounded-2xl text-xl font-black shadow-[0_4px_0_#991b1b] active:shadow-none active:translate-y-1 transition-all uppercase tracking-tighter">OK</button>
                </div>
            `;
        }

        window.add = (n) => { 
            if(currentAnswer.length < 8) currentAnswer += n; 
            render(); 
        };
        
        window.clearAll = () => { 
            currentAnswer = ""; 
            render(); 
        };
        
        window.submit = () => {
            if (currentAnswer === "") return;
            
            if (currentAnswer === task.a) {
                currentStep++;
                currentAnswer = "";
                task = generateTask();
                render();
            } else {
                // Bei Fehler: Popup-Warnung und Reset
                const main = document.getElementById('main-content');
                main.classList.add('animate-shake');
                
                // Wir nutzen einen kleinen Timeout f√ºr den Effekt
                setTimeout(() => {
                    alert("Falsch! Du musst leider wieder bei Aufgabe 1 anfangen. Konzentrier dich!");
                    currentStep = 0;
                    currentAnswer = "";
                    seed = Date.now();
                    task = generateTask();
                    render();
                }, 100);
            }
        };

        render();
    </script>
</body>
</html>
